window.PLANIMETRIA_MAP={"502":[{"orden":1,"sector":"A01","codArt":"502"},{"orden":2,"sector":"A02","codArt":"502"},{"orden":3,"sector":"A03","codArt":"502"},{"orden":4,"sector":"A04","codArt":"502"},{"orden":6,"sector":"A06","codArt":"502"},{"orden":7,"sector":"A07","codArt":"502"},{"orden":8,"sector":"A08","codArt":"502"},{"orden":9,"sector":"A09","codArt":"502"}],"321":[{"orden":5,"sector":"A05","codArt":"321"},{"orden":10,"sector":"A10","codArt":"321"},{"orden":15,"sector":"A15","codArt":"321"},{"orden":20,"sector":"A20","codArt":"321"},{"orden":25,"sector":"A25","codArt":"321"},{"orden":30,"sector":"A30","codArt":"321"},{"orden":35,"sector":"A35","codArt":"321"},{"orden":40,"sector":"A40","codArt":"321"},{"orden":45,"sector":"A45","codArt":"321"}],"501":[{"orden":11,"sector":"A11","codArt":"501"},{"orden":12,"sector":"A12","codArt":"501"},{"orden":13,"sector":"A13","codArt":"501"},{"orden":14,"sector":"A14","codArt":"501"},{"orden":16,"sector":"A16","codArt":"501"},{"orden":17,"sector":"A17","codArt":"501"},{"orden":18,"sector":"A18","codArt":"501"},{"orden":19,"sector":"A19","codArt":"501"}],"504":[{"orden":21,"sector":"A21","codArt":"504"},{"orden":22,"sector":"A22","codArt":"504"},{"orden":23,"sector":"A23","codArt":"504"},{"orden":24,"sector":"A24","codArt":"504"},{"orden":26,"sector":"A26","codArt":"504"},{"orden":27,"sector":"A27","codArt":"504"},{"orden":28,"sector":"A28","codArt":"504"},{"orden":29,"sector":"A29","codArt":"504"},{"orden":31,"sector":"A31","codArt":"504"},{"orden":32,"sector":"A32","codArt":"504"},{"orden":33,"sector":"A33","codArt":"504"},{"orden":34,"sector":"A34","codArt":"504"},{"orden":36,"sector":"A36","codArt":"504"},{"orden":37,"sector":"A37","codArt":"504"},{"orden":38,"sector":"A38","codArt":"504"},{"orden":39,"sector":"A39","codArt":"504"}],"506":[{"orden":41,"sector":"A41","codArt":"506"},{"orden":42,"sector":"A42","codArt":"506"},{"orden":43,"sector":"A43","codArt":"506"},{"orden":44,"sector":"A44","codArt":"506"},{"orden":46,"sector":"A46","codArt":"506"},{"orden":47,"sector":"A47","codArt":"506"},{"orden":48,"sector":"A48","codArt":"506"},{"orden":49,"sector":"A49","codArt":"506"},{"orden":51,"sector":"A51","codArt":"506"},{"orden":52,"sector":"A52","codArt":"506"},{"orden":53,"sector":"A53","codArt":"506"},{"orden":54,"sector":"A54","codArt":"506"},{"orden":56,"sector":"A56","codArt":"506"},{"orden":57,"sector":"A57","codArt":"506"},{"orden":58,"sector":"A58","codArt":"506"},{"orden":59,"sector":"A59","codArt":"506"}],"323":[{"orden":50,"sector":"A50","codArt":"323"}],"607E":[{"orden":55,"sector":"A55","codArt":"607E"}],"557":[{"orden":60,"sector":"A60","codArt":"557"},{"orden":451,"sector":"J33","codArt":"557"},{"orden":452,"sector":"J34","codArt":"557"},{"orden":453,"sector":"J35","codArt":"557"}],"066":[{"orden":61,"sector":"A61","codArt":"066"},{"orden":62,"sector":"A62","codArt":"066"},{"orden":63,"sector":"A63","codArt":"066"}],"565":[{"orden":64,"sector":"A64","codArt":"565"}],"558":[{"orden":65,"sector":"A65","codArt":"558"},{"orden":455,"sector":"J37","codArt":"558"},{"orden":456,"sector":"J38","codArt":"558"},{"orden":457,"sector":"J39","codArt":"558"}],"248":[{"orden":66,"sector":"A66","codArt":"248"},{"orden":72,"sector":"A71","codArt":"248"}],"332":[{"orden":67,"sector":"A67","codArt":"332"}],"338":[{"orden":68,"sector":"A67","codArt":"338"}],"500":[{"orden":69,"sector":"A68","codArt":"500"},{"orden":70,"sector":"A69","codArt":"500"}],"395":[{"orden":71,"sector":"A70","codArt":"395"}],"393":[{"orden":73,"sector":"A72","codArt":"393"}],"394":[{"orden":74,"sector":"A73","codArt":"394"}],"508":[{"orden":75,"sector":"A74","codArt":"508"}],"518":[{"orden":76,"sector":"A75","codArt":"518"}],"246":[{"orden":77,"sector":"A76","codArt":"246"},{"orden":83,"sector":"A81","codArt":"246"}],"561":[{"orden":78,"sector":"A77","codArt":"561"}],"336":[{"orden":79,"sector":"A78","codArt":"336"}],"390":[{"orden":80,"sector":"A78","codArt":"390"}],"391":[{"orden":81,"sector":"A79","codArt":"391"}],"LIBRE":[{"orden":82,"sector":"A80","codArt":"LIBRE"},{"orden":85,"sector":"A83","codArt":"LIBRE"},{"orden":148,"sector":"C01","codArt":"LIBRE"},{"orden":158,"sector":"C10","codArt":"LIBRE"},{"orden":209,"sector":"D35","codArt":"LIBRE"},{"orden":250,"sector":"E15","codArt":"LIBRE"},{"orden":326,"sector":"G09","codArt":"LIBRE"},{"orden":327,"sector":"G10","codArt":"LIBRE"},{"orden":330,"sector":"G13","codArt":"LIBRE"},{"orden":331,"sector":"G14","codArt":"LIBRE"},{"orden":332,"sector":"G15","codArt":"LIBRE"},{"orden":338,"sector":"G20","codArt":"LIBRE"},{"orden":357,"sector":"H19","codArt":"LIBRE"},{"orden":358,"sector":"H20","codArt":"LIBRE"},{"orden":396,"sector":"H58","codArt":"LIBRE"},{"orden":397,"sector":"H59","codArt":"LIBRE"},{"orden":398,"sector":"H60","codArt":"LIBRE"},{"orden":413,"sector":"I15","codArt":"LIBRE"},{"orden":414,"sector":"I16","codArt":"LIBRE"},{"orden":415,"sector":"I17","codArt":"LIBRE"},{"orden":416,"sector":"I18","codArt":"LIBRE"},{"orden":417,"sector":"I19","codArt":"LIBRE"},{"orden":418,"sector":"I20","codArt":"LIBRE"},{"orden":445,"sector":"J27","codArt":"LIBRE"},{"orden":446,"sector":"J28","codArt":"LIBRE"},{"orden":460,"sector":"J42","codArt":"LIBRE"},{"orden":463,"sector":"J45","codArt":"LIBRE"},{"orden":464,"sector":"J46","codArt":"LIBRE"},{"orden":465,"sector":"J47","codArt":"LIBRE"},{"orden":466,"sector":"J48","codArt":"LIBRE"},{"orden":467,"sector":"J49","codArt":"LIBRE"},{"orden":468,"sector":"J50","codArt":"LIBRE"},{"orden":469,"sector":"J51","codArt":"LIBRE"},{"orden":470,"sector":"J52","codArt":"LIBRE"},{"orden":471,"sector":"J53","codArt":"LIBRE"},{"orden":472,"sector":"J54","codArt":"LIBRE"},{"orden":473,"sector":"J55","codArt":"LIBRE"},{"orden":474,"sector":"J56","codArt":"LIBRE"},{"orden":475,"sector":"J57","codArt":"LIBRE"},{"orden":476,"sector":"J58","codArt":"LIBRE"},{"orden":477,"sector":"J59","codArt":"LIBRE"},{"orden":478,"sector":"J60","codArt":"LIBRE"},{"orden":673,"sector":"Ñ47","codArt":"LIBRE"},{"orden":674,"sector":"Ñ48","codArt":"LIBRE"},{"orden":675,"sector":"Ñ49","codArt":"LIBRE"},{"orden":676,"sector":"Ñ50","codArt":"LIBRE"},{"orden":677,"sector":"Ñ51","codArt":"LIBRE"},{"orden":678,"sector":"Ñ52","codArt":"LIBRE"},{"orden":679,"sector":"Ñ53","codArt":"LIBRE"},{"orden":680,"sector":"Ñ54","codArt":"LIBRE"},{"orden":681,"sector":"Ñ55","codArt":"LIBRE"},{"orden":682,"sector":"Ñ56","codArt":"LIBRE"},{"orden":685,"sector":"Ñ59","codArt":"LIBRE"},{"orden":686,"sector":"Ñ60","codArt":"LIBRE"},{"orden":687,"sector":"P01","codArt":"LIBRE"},{"orden":688,"sector":"P02","codArt":"LIBRE"},{"orden":689,"sector":"P03","codArt":"LIBRE"},{"orden":690,"sector":"P04","codArt":"LIBRE"},{"orden":691,"sector":"P05","codArt":"LIBRE"},{"orden":692,"sector":"P06","codArt":"LIBRE"},{"orden":693,"sector":"P07","codArt":"LIBRE"},{"orden":694,"sector":"P08","codArt":"LIBRE"},{"orden":695,"sector":"P09","codArt":"LIBRE"},{"orden":696,"sector":"P10","codArt":"LIBRE"},{"orden":697,"sector":"P11","codArt":"LIBRE"},{"orden":698,"sector":"P12","codArt":"LIBRE"},{"orden":699,"sector":"P13","codArt":"LIBRE"},{"orden":700,"sector":"P14","codArt":"LIBRE"},{"orden":701,"sector":"P15","codArt":"LIBRE"},{"orden":702,"sector":"P16","codArt":"LIBRE"},{"orden":703,"sector":"P17","codArt":"LIBRE"},{"orden":704,"sector":"P18","codArt":"LIBRE"},{"orden":705,"sector":"P19","codArt":"LIBRE"},{"orden":706,"sector":"P20","codArt":"LIBRE"},{"orden":707,"sector":"P21","codArt":"LIBRE"},{"orden":708,"sector":"P22","codArt":"LIBRE"},{"orden":709,"sector":"P23","codArt":"LIBRE"},{"orden":710,"sector":"P24","codArt":"LIBRE"},{"orden":711,"sector":"P25","codArt":"LIBRE"},{"orden":712,"sector":"P26","codArt":"LIBRE"},{"orden":713,"sector":"P27","codArt":"LIBRE"},{"orden":714,"sector":"P28","codArt":"LIBRE"},{"orden":715,"sector":"P29","codArt":"LIBRE"},{"orden":716,"sector":"P30","codArt":"LIBRE"},{"orden":717,"sector":"P31","codArt":"LIBRE"},{"orden":718,"sector":"P32","codArt":"LIBRE"},{"orden":719,"sector":"P33","codArt":"LIBRE"},{"orden":720,"sector":"P34","codArt":"LIBRE"},{"orden":721,"sector":"P35","codArt":"LIBRE"},{"orden":722,"sector":"P36","codArt":"LIBRE"},{"orden":723,"sector":"P37","codArt":"LIBRE"},{"orden":724,"sector":"P38","codArt":"LIBRE"},{"orden":725,"sector":"P39","codArt":"LIBRE"},{"orden":726,"sector":"P40","codArt":"LIBRE"}],"560":[{"orden":84,"sector":"A82","codArt":"560"}],"392":[{"orden":86,"sector":"A84","codArt":"392"}],"573":[{"orden":87,"sector":"A85","codArt":"573"}],"530":[{"orden":88,"sector":"B01","codArt":"530"},{"orden":89,"sector":"B02","codArt":"530"},{"orden":90,"sector":"B03","codArt":"530"},{"orden":91,"sector":"B04","codArt":"530"}],"520":[{"orden":92,"sector":"B05","codArt":"520"},{"orden":93,"sector":"B06","codArt":"520"},{"orden":94,"sector":"B07","codArt":"520"},{"orden":95,"sector":"B08","codArt":"520"}],"531":[{"orden":96,"sector":"B09","codArt":"531"},{"orden":97,"sector":"B10","codArt":"531"}],"521":[{"orden":98,"sector":"B11","codArt":"521"},{"orden":99,"sector":"B12","codArt":"521"}],"523":[{"orden":100,"sector":"B13","codArt":"523"},{"orden":101,"sector":"B14","codArt":"523"},{"orden":102,"sector":"B15","codArt":"523"},{"orden":103,"sector":"B16","codArt":"523"}],"510":[{"orden":104,"sector":"B17","codArt":"510"},{"orden":105,"sector":"B18","codArt":"510"},{"orden":106,"sector":"B19","codArt":"510"},{"orden":107,"sector":"B20","codArt":"510"},{"orden":108,"sector":"B21","codArt":"510"},{"orden":109,"sector":"B22","codArt":"510"},{"orden":110,"sector":"B23","codArt":"510"},{"orden":111,"sector":"B24","codArt":"510"}],"586":[{"orden":112,"sector":"B25","codArt":"586"},{"orden":113,"sector":"B26","codArt":"586"},{"orden":114,"sector":"B27","codArt":"586"},{"orden":115,"sector":"B28","codArt":"586"},{"orden":116,"sector":"B29","codArt":"586"},{"orden":117,"sector":"B30","codArt":"586"},{"orden":118,"sector":"B31","codArt":"586"},{"orden":119,"sector":"B32","codArt":"586"},{"orden":120,"sector":"B33","codArt":"586"},{"orden":121,"sector":"B34","codArt":"586"},{"orden":122,"sector":"B35","codArt":"586"},{"orden":123,"sector":"B36","codArt":"586"},{"orden":124,"sector":"B37","codArt":"586"},{"orden":125,"sector":"B38","codArt":"586"},{"orden":126,"sector":"B39","codArt":"586"},{"orden":127,"sector":"B40","codArt":"586"},{"orden":128,"sector":"B41","codArt":"586"},{"orden":129,"sector":"B42","codArt":"586"},{"orden":130,"sector":"B43","codArt":"586"},{"orden":131,"sector":"B44","codArt":"586"},{"orden":135,"sector":"B48","codArt":"586"},{"orden":139,"sector":"B52","codArt":"586"},{"orden":143,"sector":"B56","codArt":"586"}],"575":[{"orden":132,"sector":"B45","codArt":"575"},{"orden":133,"sector":"B46","codArt":"575"},{"orden":134,"sector":"B47","codArt":"575"}],"577":[{"orden":136,"sector":"B49","codArt":"577"},{"orden":137,"sector":"B50","codArt":"577"},{"orden":138,"sector":"B51","codArt":"577"}],"579":[{"orden":140,"sector":"B53","codArt":"579"},{"orden":141,"sector":"B54","codArt":"579"},{"orden":142,"sector":"B55","codArt":"579"}],"057":[{"orden":144,"sector":"B57","codArt":"057"}],"511":[{"orden":145,"sector":"B58","codArt":"511"}],"059":[{"orden":146,"sector":"B59","codArt":"059"}],"532":[{"orden":147,"sector":"B60","codArt":"532"}],"601E":[{"orden":149,"sector":"C02","codArt":"601E"},{"orden":150,"sector":"C03","codArt":"601E"}],"606E":[{"orden":151,"sector":"C04","codArt":"606E"},{"orden":152,"sector":"C05","codArt":"606E"}],"583E":[{"orden":153,"sector":"C06","codArt":"583E"},{"orden":159,"sector":"C11","codArt":"583E"}],"540E":[{"orden":154,"sector":"C07","codArt":"540E"},{"orden":160,"sector":"C12","codArt":"540E"}],"539E":[{"orden":155,"sector":"C08","codArt":"539E"}],"498":[{"orden":156,"sector":"C09","codArt":"498"}],"516":[{"orden":157,"sector":"C09","codArt":"516"}],"582E":[{"orden":161,"sector":"C13","codArt":"582E"}],"960E":[{"orden":162,"sector":"C14","codArt":"960E"}],"590E":[{"orden":163,"sector":"C14","codArt":"590E"}],"581T":[{"orden":164,"sector":"C15","codArt":"581T"}],"510T":[{"orden":165,"sector":"C15","codArt":"510T"}],"547":[{"orden":166,"sector":"C15","codArt":"547"}],"584E":[{"orden":167,"sector":"C16","codArt":"584E"},{"orden":168,"sector":"C17","codArt":"584E"}],"538E":[{"orden":169,"sector":"C18","codArt":"538E"}],"580":[{"orden":170,"sector":"C19","codArt":"580"}],"299":[{"orden":171,"sector":"C19","codArt":"299"}],"067":[{"orden":172,"sector":"C19","codArt":"067"}],"587T":[{"orden":173,"sector":"C20","codArt":"587T"}],"502T":[{"orden":174,"sector":"C20","codArt":"502T"}],"505":[{"orden":175,"sector":"D01","codArt":"505"},{"orden":176,"sector":"D02","codArt":"505"},{"orden":177,"sector":"D03","codArt":"505"},{"orden":178,"sector":"D04","codArt":"505"},{"orden":179,"sector":"D05","codArt":"505"},{"orden":180,"sector":"D06","codArt":"505"},{"orden":181,"sector":"D07","codArt":"505"},{"orden":182,"sector":"D08","codArt":"505"},{"orden":183,"sector":"D09","codArt":"505"},{"orden":184,"sector":"D10","codArt":"505"},{"orden":185,"sector":"D11","codArt":"505"},{"orden":186,"sector":"D12","codArt":"505"},{"orden":187,"sector":"D13","codArt":"505"},{"orden":188,"sector":"D14","codArt":"505"},{"orden":189,"sector":"D15","codArt":"505"},{"orden":190,"sector":"D16","codArt":"505"},{"orden":191,"sector":"D17","codArt":"505"},{"orden":192,"sector":"D18","codArt":"505"},{"orden":193,"sector":"D19","codArt":"505"},{"orden":194,"sector":"D20","codArt":"505"},{"orden":195,"sector":"D21","codArt":"505"},{"orden":196,"sector":"D22","codArt":"505"},{"orden":197,"sector":"D23","codArt":"505"},{"orden":198,"sector":"D24","codArt":"505"},{"orden":199,"sector":"D25","codArt":"505"},{"orden":200,"sector":"D26","codArt":"505"},{"orden":201,"sector":"D27","codArt":"505"},{"orden":202,"sector":"D28","codArt":"505"},{"orden":203,"sector":"D29","codArt":"505"},{"orden":204,"sector":"D30","codArt":"505"},{"orden":205,"sector":"D31","codArt":"505"},{"orden":206,"sector":"D32","codArt":"505"}],"515":[{"orden":207,"sector":"D33","codArt":"515"},{"orden":208,"sector":"D34","codArt":"515"}],"534":[{"orden":210,"sector":"D36","codArt":"534"}],"654":[{"orden":211,"sector":"D37","codArt":"654"}],"542":[{"orden":212,"sector":"D38","codArt":"542"}],"543":[{"orden":213,"sector":"D39","codArt":"543"}],"555":[{"orden":214,"sector":"D40","codArt":"555"}],"519":[{"orden":215,"sector":"D41","codArt":"519"},{"orden":216,"sector":"D42","codArt":"519"}],"551":[{"orden":217,"sector":"D43","codArt":"551"},{"orden":218,"sector":"D44","codArt":"551"}],"544":[{"orden":219,"sector":"D45","codArt":"544"},{"orden":220,"sector":"D46","codArt":"544"},{"orden":221,"sector":"D47","codArt":"544"},{"orden":222,"sector":"D48","codArt":"544"},{"orden":223,"sector":"D49","codArt":"544"},{"orden":224,"sector":"D50","codArt":"544"},{"orden":225,"sector":"D51","codArt":"544"},{"orden":226,"sector":"D52","codArt":"544"},{"orden":227,"sector":"D53","codArt":"544"},{"orden":228,"sector":"D54","codArt":"544"},{"orden":229,"sector":"D55","codArt":"544"},{"orden":230,"sector":"D56","codArt":"544"},{"orden":231,"sector":"D57","codArt":"544"},{"orden":232,"sector":"D58","codArt":"544"},{"orden":233,"sector":"D59","codArt":"544"},{"orden":234,"sector":"D60","codArt":"544"}],"222":[{"orden":235,"sector":"E01","codArt":"222"},{"orden":240,"sector":"E06","codArt":"222"}],"225":[{"orden":236,"sector":"E02","codArt":"225"},{"orden":237,"sector":"E03","codArt":"225"},{"orden":238,"sector":"E04","codArt":"225"},{"orden":239,"sector":"E05","codArt":"225"}],"221":[{"orden":241,"sector":"E07","codArt":"221"},{"orden":242,"sector":"E08","codArt":"221"},{"orden":243,"sector":"E09","codArt":"221"}],"337":[{"orden":244,"sector":"E10","codArt":"337"}],"312":[{"orden":245,"sector":"E10","codArt":"312"}],"220":[{"orden":246,"sector":"E11","codArt":"220"},{"orden":247,"sector":"E12","codArt":"220"}],"223":[{"orden":248,"sector":"E13","codArt":"223"},{"orden":249,"sector":"E14","codArt":"223"}],"224":[{"orden":251,"sector":"E16","codArt":"224"},{"orden":252,"sector":"E17","codArt":"224"},{"orden":253,"sector":"E18","codArt":"224"}],"550":[{"orden":254,"sector":"E19","codArt":"550"}],"311":[{"orden":255,"sector":"E20","codArt":"311"}],"026":[{"orden":256,"sector":"F01","codArt":"026"},{"orden":257,"sector":"F02","codArt":"026"},{"orden":258,"sector":"F03","codArt":"026"},{"orden":259,"sector":"F04","codArt":"026"}],"027":[{"orden":260,"sector":"F05","codArt":"027"},{"orden":261,"sector":"F06","codArt":"027"},{"orden":262,"sector":"F07","codArt":"027"},{"orden":263,"sector":"F08","codArt":"027"}],"030":[{"orden":264,"sector":"F09","codArt":"030"},{"orden":265,"sector":"F10","codArt":"030"},{"orden":266,"sector":"F11","codArt":"030"},{"orden":267,"sector":"F12","codArt":"030"}],"029":[{"orden":268,"sector":"F13","codArt":"029"},{"orden":269,"sector":"F14","codArt":"029"},{"orden":270,"sector":"F15","codArt":"029"},{"orden":271,"sector":"F16","codArt":"029"}],"513":[{"orden":272,"sector":"F17","codArt":"513"},{"orden":273,"sector":"F18","codArt":"513"},{"orden":274,"sector":"F19","codArt":"513"},{"orden":275,"sector":"F20","codArt":"513"},{"orden":276,"sector":"F21","codArt":"513"},{"orden":277,"sector":"F22","codArt":"513"},{"orden":278,"sector":"F23","codArt":"513"},{"orden":279,"sector":"F24","codArt":"513"},{"orden":280,"sector":"F25","codArt":"513"},{"orden":281,"sector":"F26","codArt":"513"},{"orden":282,"sector":"F27","codArt":"513"},{"orden":283,"sector":"F28","codArt":"513"},{"orden":284,"sector":"F29","codArt":"513"},{"orden":285,"sector":"F30","codArt":"513"},{"orden":286,"sector":"F31","codArt":"513"},{"orden":287,"sector":"F32","codArt":"513"},{"orden":288,"sector":"F33","codArt":"513"},{"orden":289,"sector":"F34","codArt":"513"},{"orden":290,"sector":"F35","codArt":"513"},{"orden":291,"sector":"F36","codArt":"513"},{"orden":292,"sector":"F37","codArt":"513"},{"orden":293,"sector":"F38","codArt":"513"},{"orden":294,"sector":"F39","codArt":"513"},{"orden":295,"sector":"F40","codArt":"513"},{"orden":296,"sector":"F41","codArt":"513"},{"orden":297,"sector":"F42","codArt":"513"},{"orden":298,"sector":"F43","codArt":"513"},{"orden":299,"sector":"F44","codArt":"513"}],"546":[{"orden":300,"sector":"F45","codArt":"546"},{"orden":301,"sector":"F46","codArt":"546"},{"orden":302,"sector":"F47","codArt":"546"},{"orden":303,"sector":"F48","codArt":"546"},{"orden":306,"sector":"F51","codArt":"546"},{"orden":307,"sector":"F52","codArt":"546"},{"orden":311,"sector":"F56","codArt":"546"}],"574":[{"orden":304,"sector":"F49","codArt":"574"},{"orden":305,"sector":"F50","codArt":"574"}],"559":[{"orden":308,"sector":"F53","codArt":"559"},{"orden":309,"sector":"F54","codArt":"559"},{"orden":310,"sector":"F55","codArt":"559"}],"325":[{"orden":312,"sector":"F57","codArt":"325"},{"orden":313,"sector":"F58","codArt":"325"},{"orden":314,"sector":"F59","codArt":"325"},{"orden":315,"sector":"F60","codArt":"325"}],"229":[{"orden":316,"sector":"G01","codArt":"229"},{"orden":317,"sector":"G02","codArt":"229"}],"058":[{"orden":318,"sector":"G03","codArt":"058"}],"326":[{"orden":319,"sector":"G03","codArt":"326"}],"499":[{"orden":320,"sector":"G03","codArt":"499"}],"207":[{"orden":321,"sector":"G04","codArt":"207"}],"569":[{"orden":322,"sector":"G05","codArt":"569"}],"208":[{"orden":323,"sector":"G06","codArt":"208"}],"355":[{"orden":324,"sector":"G07","codArt":"355"},{"orden":325,"sector":"G08","codArt":"355"}],"823":[{"orden":328,"sector":"G11","codArt":"823"},{"orden":329,"sector":"G12","codArt":"823"}],"594":[{"orden":333,"sector":"G16","codArt":"594"}],"595":[{"orden":334,"sector":"G17","codArt":"595"}],"596":[{"orden":335,"sector":"G18","codArt":"596"}],"509":[{"orden":336,"sector":"G19","codArt":"509"}],"570":[{"orden":337,"sector":"G19","codArt":"570"}],"811E":[{"orden":339,"sector":"H01","codArt":"811E"},{"orden":340,"sector":"H02","codArt":"811E"}],"525E":[{"orden":341,"sector":"H03","codArt":"525E"},{"orden":342,"sector":"H04","codArt":"525E"}],"529E":[{"orden":343,"sector":"H05","codArt":"529E"},{"orden":344,"sector":"H06","codArt":"529E"},{"orden":345,"sector":"H07","codArt":"529E"}],"819E":[{"orden":346,"sector":"H08","codArt":"819E"}],"503E":[{"orden":347,"sector":"H09","codArt":"503E"}],"816E":[{"orden":348,"sector":"H10","codArt":"816E"},{"orden":352,"sector":"H14","codArt":"816E"}],"585E":[{"orden":349,"sector":"H11","codArt":"585E"},{"orden":350,"sector":"H12","codArt":"585E"}],"589E":[{"orden":351,"sector":"H13","codArt":"589E"}],"817E":[{"orden":353,"sector":"H15","codArt":"817E"}],"260E":[{"orden":354,"sector":"H16","codArt":"260E"}],"541E":[{"orden":355,"sector":"H17","codArt":"541E"}],"812E":[{"orden":356,"sector":"H18","codArt":"812E"}],"564":[{"orden":359,"sector":"H21","codArt":"564"},{"orden":360,"sector":"H22","codArt":"564"}],"562":[{"orden":361,"sector":"H23","codArt":"562"},{"orden":362,"sector":"H24","codArt":"562"}],"587":[{"orden":363,"sector":"H25","codArt":"587"},{"orden":364,"sector":"H26","codArt":"587"},{"orden":365,"sector":"H27","codArt":"587"},{"orden":366,"sector":"H28","codArt":"587"}],"581":[{"orden":367,"sector":"H29","codArt":"581"},{"orden":368,"sector":"H30","codArt":"581"},{"orden":369,"sector":"H31","codArt":"581"},{"orden":370,"sector":"H32","codArt":"581"}],"439E":[{"orden":371,"sector":"H33","codArt":"439E"},{"orden":372,"sector":"H34","codArt":"439E"}],"440E":[{"orden":373,"sector":"H35","codArt":"440E"},{"orden":374,"sector":"H36","codArt":"440E"}],"512":[{"orden":375,"sector":"H37","codArt":"512"},{"orden":376,"sector":"H38","codArt":"512"},{"orden":377,"sector":"H39","codArt":"512"},{"orden":378,"sector":"H40","codArt":"512"}],"535":[{"orden":379,"sector":"H41","codArt":"535"},{"orden":380,"sector":"H42","codArt":"535"},{"orden":381,"sector":"H43","codArt":"535"},{"orden":382,"sector":"H44","codArt":"535"}],"031":[{"orden":383,"sector":"H45","codArt":"031"},{"orden":384,"sector":"H46","codArt":"031"},{"orden":385,"sector":"H47","codArt":"031"},{"orden":386,"sector":"H48","codArt":"031"},{"orden":387,"sector":"H49","codArt":"031"},{"orden":388,"sector":"H50","codArt":"031"},{"orden":389,"sector":"H51","codArt":"031"},{"orden":390,"sector":"H52","codArt":"031"}],"034":[{"orden":391,"sector":"H53","codArt":"034"},{"orden":392,"sector":"H54","codArt":"034"}],"035E":[{"orden":393,"sector":"H55","codArt":"035E"},{"orden":394,"sector":"H56","codArt":"035E"}],"592":[{"orden":395,"sector":"H57","codArt":"592"}],"932E":[{"orden":399,"sector":"I01","codArt":"932E"}],"933E":[{"orden":400,"sector":"I02","codArt":"933E"}],"934E":[{"orden":401,"sector":"I03","codArt":"934E"}],"935E":[{"orden":402,"sector":"I04","codArt":"935E"}],"936E":[{"orden":403,"sector":"I05","codArt":"936E"}],"937E":[{"orden":404,"sector":"I06","codArt":"937E"}],"942E":[{"orden":405,"sector":"I07","codArt":"942E"}],"943E":[{"orden":406,"sector":"I08","codArt":"943E"}],"944E":[{"orden":407,"sector":"I09","codArt":"944E"}],"945E":[{"orden":408,"sector":"I10","codArt":"945E"}],"948E":[{"orden":409,"sector":"I11","codArt":"948E"}],"952E":[{"orden":410,"sector":"I12","codArt":"952E"}],"953E":[{"orden":411,"sector":"I13","codArt":"953E"}],"955E":[{"orden":412,"sector":"I14","codArt":"955E"}],"328E":[{"orden":419,"sector":"J1","codArt":"328E"}],"360E":[{"orden":420,"sector":"J2","codArt":"360E"}],"361E":[{"orden":421,"sector":"J3","codArt":"361E"}],"363E":[{"orden":422,"sector":"J4","codArt":"363E"}],"366E":[{"orden":423,"sector":"J5","codArt":"366E"}],"367E":[{"orden":424,"sector":"J6","codArt":"367E"}],"810E":[{"orden":425,"sector":"J7","codArt":"810E"}],"870E":[{"orden":426,"sector":"J8","codArt":"870E"}],"315":[{"orden":427,"sector":"J9","codArt":"315"},{"orden":428,"sector":"J10","codArt":"315"},{"orden":429,"sector":"J11","codArt":"315"},{"orden":430,"sector":"J12","codArt":"315"}],"809E":[{"orden":431,"sector":"J13","codArt":"809E"},{"orden":432,"sector":"J14","codArt":"809E"}],"598E":[{"orden":433,"sector":"J15","codArt":"598E"},{"orden":434,"sector":"J16","codArt":"598E"}],"234":[{"orden":435,"sector":"J17","codArt":"234"},{"orden":436,"sector":"J18","codArt":"234"}],"323E":[{"orden":437,"sector":"J19","codArt":"323E"},{"orden":438,"sector":"J20","codArt":"323E"}],"404E":[{"orden":439,"sector":"J21","codArt":"404E"},{"orden":440,"sector":"J22","codArt":"404E"}],"070":[{"orden":441,"sector":"J23","codArt":"070"},{"orden":442,"sector":"J24","codArt":"070"}],"597":[{"orden":443,"sector":"J25","codArt":"597"}],"591":[{"orden":444,"sector":"J26","codArt":"591"}],"507":[{"orden":447,"sector":"J29","codArt":"507"},{"orden":448,"sector":"J30","codArt":"507"},{"orden":449,"sector":"J31","codArt":"507"}],"280":[{"orden":450,"sector":"J32","codArt":"280"},{"orden":454,"sector":"J36","codArt":"280"}],"334":[{"orden":458,"sector":"J40","codArt":"334"}],"333":[{"orden":459,"sector":"J41","codArt":"333"}],"590ES":[{"orden":461,"sector":"J43","codArt":"590ES"}],"335":[{"orden":462,"sector":"J44","codArt":"335"}],"825":[{"orden":479,"sector":"L01","codArt":"825"},{"orden":480,"sector":"L02","codArt":"825"}],"824":[{"orden":481,"sector":"L03","codArt":"824"},{"orden":482,"sector":"L04","codArt":"824"}],"438E":[{"orden":483,"sector":"L05","codArt":"438E"},{"orden":484,"sector":"L06","codArt":"438E"}],"437E":[{"orden":485,"sector":"L07","codArt":"437E"},{"orden":486,"sector":"L08","codArt":"437E"}],"099":[{"orden":487,"sector":"L09","codArt":"099"},{"orden":488,"sector":"L10","codArt":"099"},{"orden":489,"sector":"L11","codArt":"099"},{"orden":490,"sector":"L12","codArt":"099"}],"706":[{"orden":491,"sector":"L13","codArt":"706"},{"orden":492,"sector":"L14","codArt":"706"},{"orden":493,"sector":"L15","codArt":"706"},{"orden":494,"sector":"L16","codArt":"706"}],"713":[{"orden":495,"sector":"L17","codArt":"713"},{"orden":496,"sector":"L18","codArt":"713"},{"orden":497,"sector":"L19","codArt":"713"},{"orden":498,"sector":"L20","codArt":"713"}],"097":[{"orden":499,"sector":"L21","codArt":"097"},{"orden":500,"sector":"L22","codArt":"097"},{"orden":501,"sector":"L23","codArt":"097"},{"orden":502,"sector":"L24","codArt":"097"}],"922":[{"orden":503,"sector":"L25","codArt":"922"},{"orden":504,"sector":"L26","codArt":"922"},{"orden":505,"sector":"L27","codArt":"922"},{"orden":506,"sector":"L28","codArt":"922"}],"847":[{"orden":507,"sector":"L29","codArt":"847"},{"orden":508,"sector":"L30","codArt":"847"},{"orden":509,"sector":"L31","codArt":"847"}],"609":[{"orden":510,"sector":"L32","codArt":"609"}],"727E":[{"orden":511,"sector":"L33","codArt":"727E"}],"735":[{"orden":512,"sector":"L34","codArt":"735"}],"802":[{"orden":513,"sector":"L35","codArt":"802"},{"orden":514,"sector":"L36","codArt":"802"}],"730":[{"orden":515,"sector":"L37","codArt":"730"}],"731":[{"orden":516,"sector":"L38","codArt":"731"}],"723":[{"orden":517,"sector":"L39","codArt":"723"}],"725E":[{"orden":518,"sector":"L40","codArt":"725E"},{"orden":523,"sector":"L45","codArt":"725E"}],"911":[{"orden":519,"sector":"L41","codArt":"911"}],"920":[{"orden":520,"sector":"L42","codArt":"920"}],"902":[{"orden":521,"sector":"L43","codArt":"902"}],"909":[{"orden":522,"sector":"L44","codArt":"909"}],"729E":[{"orden":524,"sector":"L46","codArt":"729E"}],"908":[{"orden":525,"sector":"L47","codArt":"908"}],"900":[{"orden":526,"sector":"L48","codArt":"900"}],"053":[{"orden":527,"sector":"L49","codArt":"053"}],"054":[{"orden":528,"sector":"L50","codArt":"054"}],"055":[{"orden":529,"sector":"L51","codArt":"055"}],"456":[{"orden":530,"sector":"L52","codArt":"456"}],"707":[{"orden":531,"sector":"L53","codArt":"707"}],"708":[{"orden":532,"sector":"L53","codArt":"708"}],"732":[{"orden":533,"sector":"L54","codArt":"732"}],"977":[{"orden":534,"sector":"L54","codArt":"977"}],"052":[{"orden":535,"sector":"L55","codArt":"052"}],"720":[{"orden":536,"sector":"L56","codArt":"720"}],"722":[{"orden":537,"sector":"L56","codArt":"722"}],"865E":[{"orden":538,"sector":"L57","codArt":"865E"}],"690E":[{"orden":539,"sector":"L58","codArt":"690E"}],"453":[{"orden":540,"sector":"L59","codArt":"453"}],"307":[{"orden":541,"sector":"L60","codArt":"307"}],"701":[{"orden":542,"sector":"M01","codArt":"701"},{"orden":543,"sector":"M02","codArt":"701"},{"orden":544,"sector":"M03","codArt":"701"},{"orden":545,"sector":"M04","codArt":"701"}],"901":[{"orden":546,"sector":"M05","codArt":"901"},{"orden":547,"sector":"M06","codArt":"901"},{"orden":548,"sector":"M07","codArt":"901"},{"orden":549,"sector":"M08","codArt":"901"}],"702E":[{"orden":550,"sector":"M09","codArt":"702E"}],"702":[{"orden":551,"sector":"M10","codArt":"702"}],"836":[{"orden":552,"sector":"M11","codArt":"836"},{"orden":553,"sector":"M12","codArt":"836"}],"809":[{"orden":554,"sector":"M13","codArt":"809"},{"orden":555,"sector":"M14","codArt":"809"},{"orden":556,"sector":"M15","codArt":"809"},{"orden":557,"sector":"M16","codArt":"809"}],"910":[{"orden":558,"sector":"M17","codArt":"910"},{"orden":559,"sector":"M18","codArt":"910"}],"043":[{"orden":560,"sector":"M19","codArt":"043"},{"orden":561,"sector":"M20","codArt":"043"}],"839":[{"orden":562,"sector":"M21","codArt":"839"}],"816":[{"orden":563,"sector":"M22","codArt":"816"}],"817":[{"orden":564,"sector":"M23","codArt":"817"},{"orden":565,"sector":"M24","codArt":"817"}],"712E":[{"orden":566,"sector":"M25","codArt":"712E"}],"762":[{"orden":567,"sector":"M26","codArt":"762"}],"769":[{"orden":568,"sector":"M26","codArt":"769"}],"763":[{"orden":569,"sector":"M27","codArt":"763"}],"747":[{"orden":570,"sector":"M27","codArt":"747"}],"764":[{"orden":571,"sector":"M28","codArt":"764"}],"760":[{"orden":572,"sector":"M29","codArt":"760"}],"761":[{"orden":573,"sector":"M29","codArt":"761"}],"717":[{"orden":574,"sector":"M30","codArt":"717"}],"878":[{"orden":575,"sector":"M30","codArt":"878"}],"718":[{"orden":576,"sector":"M31","codArt":"718"}],"719":[{"orden":577,"sector":"M31","codArt":"719"}],"755":[{"orden":578,"sector":"M32","codArt":"755"}],"862":[{"orden":579,"sector":"M33","codArt":"862"}],"863":[{"orden":580,"sector":"M33","codArt":"863"}],"859":[{"orden":581,"sector":"M33","codArt":"859"}],"630":[{"orden":582,"sector":"M34","codArt":"630"}],"631":[{"orden":583,"sector":"M34","codArt":"631"}],"632":[{"orden":584,"sector":"M34","codArt":"632"}],"633":[{"orden":585,"sector":"M35","codArt":"633"}],"634":[{"orden":586,"sector":"M35","codArt":"634"}],"635":[{"orden":587,"sector":"M35","codArt":"635"}],"636":[{"orden":588,"sector":"M36","codArt":"636"}],"637":[{"orden":589,"sector":"M36","codArt":"637"}],"613":[{"orden":590,"sector":"M36","codArt":"613"}],"858":[{"orden":591,"sector":"M36","codArt":"858"}],"789":[{"orden":592,"sector":"M37","codArt":"789"}],"842":[{"orden":593,"sector":"M38","codArt":"842"}],"843":[{"orden":594,"sector":"M38","codArt":"843"}],"844":[{"orden":595,"sector":"M39","codArt":"844"}],"845":[{"orden":596,"sector":"M39","codArt":"845"}],"846":[{"orden":597,"sector":"M40","codArt":"846"}],"700":[{"orden":598,"sector":"M41","codArt":"700"}],"618":[{"orden":599,"sector":"M41","codArt":"618"}],"619":[{"orden":600,"sector":"M41","codArt":"619"},{"orden":606,"sector":"M44","codArt":"619"}],"615":[{"orden":601,"sector":"M42","codArt":"615"}],"856":[{"orden":602,"sector":"M42","codArt":"856"}],"857":[{"orden":603,"sector":"M42","codArt":"857"}],"848":[{"orden":604,"sector":"M43","codArt":"848"}],"818":[{"orden":605,"sector":"M43","codArt":"818"}],"890E":[{"orden":607,"sector":"M44","codArt":"890E"}],"800":[{"orden":608,"sector":"M45","codArt":"800"}],"801":[{"orden":609,"sector":"M46","codArt":"801"}],"852":[{"orden":610,"sector":"M46","codArt":"852"}],"867":[{"orden":611,"sector":"M47","codArt":"867"}],"715":[{"orden":612,"sector":"M47","codArt":"715"}],"709":[{"orden":613,"sector":"M48","codArt":"709"}],"710":[{"orden":614,"sector":"M48","codArt":"710"}],"840":[{"orden":615,"sector":"M49","codArt":"840"},{"orden":616,"sector":"M50","codArt":"840"},{"orden":617,"sector":"M51","codArt":"840"},{"orden":618,"sector":"M52","codArt":"840"},{"orden":619,"sector":"M53","codArt":"840"},{"orden":620,"sector":"M54","codArt":"840"},{"orden":621,"sector":"M55","codArt":"840"},{"orden":622,"sector":"M56","codArt":"840"},{"orden":623,"sector":"M57","codArt":"840"},{"orden":624,"sector":"M58","codArt":"840"},{"orden":625,"sector":"M59","codArt":"840"},{"orden":626,"sector":"M60","codArt":"840"}],"103":[{"orden":627,"sector":"Ñ01","codArt":"103"},{"orden":628,"sector":"Ñ02","codArt":"103"}],"104":[{"orden":629,"sector":"Ñ03","codArt":"104"},{"orden":630,"sector":"Ñ04","codArt":"104"}],"102":[{"orden":631,"sector":"Ñ05","codArt":"102"},{"orden":632,"sector":"Ñ06","codArt":"102"},{"orden":633,"sector":"Ñ07","codArt":"102"},{"orden":634,"sector":"Ñ08","codArt":"102"}],"106":[{"orden":635,"sector":"Ñ09","codArt":"106"},{"orden":636,"sector":"Ñ10","codArt":"106"},{"orden":637,"sector":"Ñ11","codArt":"106"},{"orden":638,"sector":"Ñ12","codArt":"106"}],"108":[{"orden":639,"sector":"Ñ13","codArt":"108"}],"109":[{"orden":640,"sector":"Ñ14","codArt":"109"}],"111":[{"orden":641,"sector":"Ñ15","codArt":"111"},{"orden":642,"sector":"Ñ16","codArt":"111"}],"112":[{"orden":643,"sector":"Ñ17","codArt":"112"},{"orden":644,"sector":"Ñ18","codArt":"112"}],"113":[{"orden":645,"sector":"Ñ19","codArt":"113"},{"orden":646,"sector":"Ñ20","codArt":"113"}],"110":[{"orden":647,"sector":"Ñ21","codArt":"110"},{"orden":648,"sector":"Ñ22","codArt":"110"}],"115":[{"orden":649,"sector":"Ñ23","codArt":"115"},{"orden":650,"sector":"Ñ24","codArt":"115"}],"121":[{"orden":651,"sector":"Ñ25","codArt":"121"},{"orden":655,"sector":"Ñ29","codArt":"121"}],"119":[{"orden":652,"sector":"Ñ26","codArt":"119"}],"116":[{"orden":653,"sector":"Ñ27","codArt":"116"}],"114":[{"orden":654,"sector":"Ñ28","codArt":"114"}],"124":[{"orden":656,"sector":"Ñ30","codArt":"124"},{"orden":657,"sector":"Ñ31","codArt":"124"}],"101":[{"orden":658,"sector":"Ñ32","codArt":"101"}],"123":[{"orden":659,"sector":"Ñ33","codArt":"123"},{"orden":660,"sector":"Ñ34","codArt":"123"},{"orden":661,"sector":"Ñ35","codArt":"123"},{"orden":662,"sector":"Ñ36","codArt":"123"},{"orden":665,"sector":"Ñ39","codArt":"123"},{"orden":666,"sector":"Ñ40","codArt":"123"}],"186":[{"orden":663,"sector":"Ñ37","codArt":"186"},{"orden":664,"sector":"Ñ38","codArt":"186"},{"orden":667,"sector":"Ñ41","codArt":"186"},{"orden":668,"sector":"Ñ42","codArt":"186"}],"193":[{"orden":669,"sector":"Ñ43","codArt":"193"},{"orden":670,"sector":"Ñ44","codArt":"193"}],"198E":[{"orden":671,"sector":"Ñ45","codArt":"198E"},{"orden":672,"sector":"Ñ46","codArt":"198E"}],"798E":[{"orden":683,"sector":"Ñ57","codArt":"798E"},{"orden":684,"sector":"Ñ58","codArt":"798E"}]};
/***********************
 * LOGICA DE LA APP (ENVIO UNICO AL FINAL)
 ***********************/
(function(){
  const APP_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyfh9xaVqS-POGY1lB4WJmn_MWhRkoEN1YL8g3SQ6dezMJoMcGGXEjtvs5xghHZM41U/exec";
  const MAP = (window.PLANIMETRIA_MAP || {});
  const $ = (id) => document.getElementById(id);

  function normalizeCode(v){ return String(v ?? "").trim().toUpperCase().replace(/\s+/g, ""); }
  function onlyDigits(v){ return String(v ?? "").replace(/[^\d]/g, ""); }

  function showOverlay(on, title="Enviando…", sub="Guardando en Google Sheet"){
    $("overlayTitle").textContent = title;
    $("overlaySub").textContent = sub;
    $("overlay").style.display = on ? "flex" : "none";
  }

  function switchTab(n){
    $("tab1").style.display = (n===1) ? "" : "none";
    $("tab2").style.display = (n===2) ? "" : "none";
    $("tab3").style.display = (n===3) ? "" : "none";
  }

  function setStatus(){
    const leg = onlyDigits($("legajo").value).slice(0,3);
    const c1 = normalizeCode($("cod1").value).slice(0,4);
    const c2 = normalizeCode($("cod2").value).slice(0,4);
    const cnt = [c1,c2].filter(Boolean).length;
    $("statusPill").textContent = leg ? `Legajo ${leg} · ${cnt} código(s)` : "Sin datos";
  }

  const STATE = { legajo:"", codes:[], rows:[], fills:{}, resumen:{} };
  function rowKey(r){ return `${r.orden}|${r.sector}|${r.codArt}`; }

  function buildSelect(min, max, selectedValue){
    const sel = document.createElement("select");
    const opt0 = document.createElement("option");
    opt0.value = ""; opt0.textContent = "—";
    sel.appendChild(opt0);
    for(let i=min;i<=max;i++){
      const opt = document.createElement("option");
      opt.value = String(i);
      opt.textContent = String(i);
      if(String(i) === String(selectedValue)) opt.selected = true;
      sel.appendChild(opt);
    }
    return sel;
  }

  function calcTotal(pilas, cxp, sueltas){
    const P = parseInt(pilas || "0", 10);
    const C = parseInt(cxp || "0", 10);
    const S = parseInt(sueltas || "0", 10);
    return (P*C + S);
  }

  function parseTab1(){
    const legajo = onlyDigits($("legajo").value).slice(0,3);
    const cod1 = normalizeCode($("cod1").value).slice(0,4);
    const cod2 = normalizeCode($("cod2").value).slice(0,4);

    $("msg1").textContent = ""; $("msg1b").textContent = "";
    $("msg1").className = "msg"; $("msg1b").className = "msg";

    if(!legajo){
      $("msg1").textContent = "Ingresá el número de legajo.";
      $("msg1").classList.add("error");
      return null;
    }
    const codes = [cod1,cod2].filter(Boolean);
    if(codes.length === 0){
      $("msg1b").textContent = "Ingresá al menos 1 código.";
      $("msg1b").classList.add("error");
      return null;
    }

    const uniq = Array.from(new Set(codes));
    const rows = [];

    for(const code of uniq){
      const locs = MAP[code];
      if(Array.isArray(locs) && locs.length){
        for(const loc of locs){
          rows.push({
            orden: Number(loc.orden),
            sector: String(loc.sector),
            codArt: String(loc.codArt ?? code)
          });
        }
      } else {
        rows.push({ orden: 999999, sector: "SIN MAPEO", codArt: code });
      }
    }

    rows.sort((a,b) => (a.orden-b.orden) || a.sector.localeCompare(b.sector) || a.codArt.localeCompare(b.codArt));
    return { legajo, codes: uniq, rows };
  }

  function renderTab2(){
    $("legajoLine").textContent = `Legajo: ${STATE.legajo}`;
    $("countPill").textContent = `${STATE.rows.length} filas`;

    const tbody = $("tbody");
    tbody.innerHTML = "";

    for(const r of STATE.rows){
      const key = rowKey(r);
      if(!STATE.fills[key]) STATE.fills[key] = { pilas:"", cjasXPila:"", cjasSueltas:"" };

      const tr = document.createElement("tr");

      const tdSec = document.createElement("td"); tdSec.textContent = r.sector;
      const tdCod = document.createElement("td"); tdCod.textContent = r.codArt;

      const tdP = document.createElement("td"); tdP.className = "compact";
      const selP = buildSelect(1,30, STATE.fills[key].pilas);

      const tdCxp = document.createElement("td"); tdCxp.className = "compact";
      const selCxp = buildSelect(1,10, STATE.fills[key].cjasXPila);

      const tdS = document.createElement("td"); tdS.className = "compact";
      const inpS = document.createElement("input");
      inpS.type = "tel"; inpS.inputMode = "numeric"; inpS.maxLength = 2;
      inpS.placeholder = "0";
      inpS.value = STATE.fills[key].cjasSueltas || "";

      function clamp2Digits(){
        inpS.value = onlyDigits(inpS.value).slice(0,2);
        STATE.fills[key].cjasSueltas = inpS.value;
      }

      selP.addEventListener("change", () => { STATE.fills[key].pilas = selP.value; });
      selCxp.addEventListener("change", () => { STATE.fills[key].cjasXPila = selCxp.value; });
      inpS.addEventListener("input", clamp2Digits);

      tdP.appendChild(selP);
      tdCxp.appendChild(selCxp);
      tdS.appendChild(inpS);

      tr.appendChild(tdSec);
      tr.appendChild(tdCod);
      tr.appendChild(tdP);
      tr.appendChild(tdCxp);
      tr.appendChild(tdS);

      tbody.appendChild(tr);
    }
  }

  function renderTab3(){
    $("legajoLine3").textContent = `Legajo: ${STATE.legajo}`;
    $("countPill3").textContent = `${STATE.codes.length} códigos`;

    const tbody = $("tbody3");
    tbody.innerHTML = "";

    for(const code of STATE.codes){
      if(!STATE.resumen[code]) STATE.resumen[code] = { pickings:"", pfc:"", transito:"" };

      const tr = document.createElement("tr");

      const tdCod = document.createElement("td");
      tdCod.textContent = code;

      const tdPA = document.createElement("td"); tdPA.className="compact";
      const inpPA = document.createElement("input");
      inpPA.type="tel"; inpPA.inputMode="numeric"; inpPA.maxLength=2; inpPA.placeholder="0";
      inpPA.value = STATE.resumen[code].pickings || "";

      const tdPFC = document.createElement("td"); tdPFC.className="compact";
      const inpPFC = document.createElement("input");
      inpPFC.type="tel"; inpPFC.inputMode="numeric"; inpPFC.maxLength=2; inpPFC.placeholder="0";
      inpPFC.value = STATE.resumen[code].pfc || "";

      const tdMT = document.createElement("td"); tdMT.className="compact";
      const inpMT = document.createElement("input");
      inpMT.type="tel"; inpMT.inputMode="numeric"; inpMT.maxLength=2; inpMT.placeholder="0";
      inpMT.value = STATE.resumen[code].transito || "";

      function clamp(codeKey, field, el){
        el.value = onlyDigits(el.value).slice(0,2);
        STATE.resumen[codeKey][field] = el.value;
      }

      inpPA.addEventListener("input", () => clamp(code, "pickings", inpPA));
      inpPFC.addEventListener("input", () => clamp(code, "pfc", inpPFC));
      inpMT.addEventListener("input", () => clamp(code, "transito", inpMT));

      tdPA.appendChild(inpPA);
      tdPFC.appendChild(inpPFC);
      tdMT.appendChild(inpMT);

      tr.appendChild(tdCod);
      tr.appendChild(tdPA);
      tr.appendChild(tdPFC);
      tr.appendChild(tdMT);

      tbody.appendChild(tr);
    }
  }

  function buildFinalPayload(){
    // Paso 2 rows
    const paso2Rows = STATE.rows.map(r => {
      const key = rowKey(r);
      const f = STATE.fills[key] || {};
      const total = calcTotal(f.pilas, f.cjasXPila, f.cjasSueltas);
      return {
        orden: (r.orden === 999999 ? "" : r.orden),
        sector: r.sector,
        codArt: r.codArt,
        pilas: f.pilas || "",
        cjasXPila: f.cjasXPila || "",
        cjasSueltas: f.cjasSueltas || "",
        totalCjas: String(total),
        key
      };
    });

    // Paso 3 rows
    const paso3Rows = STATE.codes.map(code => ({
      codArt: code,
      pickingsArmados: STATE.resumen[code]?.pickings ?? "",
      pedidosParaFC: STATE.resumen[code]?.pfc ?? "",
      mercaderiaEnTransito: STATE.resumen[code]?.transito ?? ""
    }));

    return {
      kind: "final",
      ts: new Date().toISOString(),
      legajo: STATE.legajo,
      paso2Rows,
      paso3Rows
    };
  }

  async function sendFinal(){
    const msg = $("msg3");
    msg.textContent = "";
    msg.className = "msg";

    try{
      showOverlay(true, "Enviando…", "Guardando todo (Paso 2 + Paso 3)");

      await fetch(APP_SCRIPT_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify(buildFinalPayload())
      });

      await new Promise(r => setTimeout(r, 700));
      showOverlay(false);
      resetAll();

    }catch(e){
      showOverlay(false);
      msg.textContent = "Error enviando: " + (e?.message || e);
      msg.classList.add("error");
    }
  }

  function resetAll(){
    $("legajo").value = "";
    $("cod1").value = "";
    $("cod2").value = "";
    $("msg1").textContent = "";
    $("msg1b").textContent = "";
    $("msgSend").textContent = "";
    $("msg3").textContent = "";

    STATE.legajo = "";
    STATE.codes = [];
    STATE.rows = [];
    STATE.fills = {};
    STATE.resumen = {};

    setStatus();
    switchTab(1);
    $("legajo").focus();
  }

  // --- Eventos ---
  $("legajo").addEventListener("input", () => { $("legajo").value = onlyDigits($("legajo").value).slice(0,3); setStatus(); });
  $("cod1").addEventListener("input", () => { $("cod1").value = normalizeCode($("cod1").value).slice(0,4); setStatus(); });
  $("cod2").addEventListener("input", () => { $("cod2").value = normalizeCode($("cod2").value).slice(0,4); setStatus(); });

  $("limpiarBtn").addEventListener("click", resetAll);

  $("siguienteBtn").addEventListener("click", () => {
    const parsed = parseTab1();
    if(!parsed) return;
    STATE.legajo = parsed.legajo;
    STATE.codes = parsed.codes;
    STATE.rows = parsed.rows;
    STATE.fills = {};
    STATE.resumen = {};
    renderTab2();
    switchTab(2);
  });

  $("volverBtn").addEventListener("click", () => switchTab(1));

  $("resetFillsBtn").addEventListener("click", () => {
    for(const k of Object.keys(STATE.fills)){
      STATE.fills[k] = { pilas:"", cjasXPila:"", cjasSueltas:"" };
    }
    renderTab2();
    $("msgSend").textContent = "Reseteado.";
    $("msgSend").className = "msg ok";
  });

  // PASO 2 -> PASO 3 (SIN ENVIAR)
  $("irPaso3Btn").addEventListener("click", () => {
    renderTab3();
    switchTab(3);
  });

  $("volverBtn3").addEventListener("click", () => switchTab(2));

  $("reset3Btn").addEventListener("click", () => {
    for(const c of STATE.codes){
      STATE.resumen[c] = { pickings:"", pfc:"", transito:"" };
    }
    renderTab3();
    $("msg3").textContent = "Reseteado.";
    $("msg3").className = "msg ok";
  });

  $("enviarFinalBtn").addEventListener("click", sendFinal);

  // init
  setStatus();
})();
